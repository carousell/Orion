# httptripper
`import "github.com/carousell/Orion/utils/httptripper"`

* [Overview](#pkg-overview)
* [Imported Packages](#pkg-imports)
* [Index](#pkg-index)

## <a name="pkg-overview">Overview</a>
Package httptripper provides an implementation of http.RoundTripper that provides retries, popluates opentracing span info and hystrix circuit breaker.

### Setup
for most cases using the http.Client provided by the package is sufficient

	client := httptripper.NewHTTPClient(time.Millisecond * 500)

Note: If you are using a custom http.Client, then just wrap your custom http.Client using httptripper.WrapTripper

	tripper := httptripper.WrapTripper(client.Transport)
	client.Transport = tripper

### How To Use
Make sure you use httptripper.NewRequest to build http.Request, since http.NewRequest does not take context as parameter

	httpReq, err := httptripper.NewRequest(ctx, "TracingName", "GET", url, nil)

## <a name="pkg-imports">Imported Packages</a>

- [github.com/afex/hystrix-go/hystrix](https://godoc.org/github.com/afex/hystrix-go/hystrix)
- [github.com/carousell/Orion/utils/httptripper/retry](./retry)
- [github.com/carousell/Orion/utils/spanutils](./../spanutils)

## <a name="pkg-index">Index</a>
* [func GetRequestTraceName(req \*http.Request) string](#GetRequestTraceName)
* [func NewHTTPClient(timeout time.Duration) \*http.Client](#NewHTTPClient)
* [func NewRequest(ctx context.Context, traceName, method, url string, body io.Reader) (\*http.Request, error)](#NewRequest)
* [func NewTripper() http.RoundTripper](#NewTripper)
* [func SetRequestTraceName(req \*http.Request, traceName string) \*http.Request](#SetRequestTraceName)
* [func WrapTripper(base http.RoundTripper) http.RoundTripper](#WrapTripper)

#### <a name="pkg-files">Package files</a>
[httptripper.go](./httptripper.go) 

## <a name="GetRequestTraceName">func</a> [GetRequestTraceName](./httptripper.go#L159)
``` go
func GetRequestTraceName(req *http.Request) string
```
GetRequestTraceName fetches a trace name from HTTP request

## <a name="NewHTTPClient">func</a> [NewHTTPClient](./httptripper.go#L131)
``` go
func NewHTTPClient(timeout time.Duration) *http.Client
```
NewHTTPClient creates a new http.Client with default retry options and timeout

## <a name="NewRequest">func</a> [NewRequest](./httptripper.go#L143)
``` go
func NewRequest(ctx context.Context, traceName, method, url string, body io.Reader) (*http.Request, error)
```
NewRequest extends http.NewRequest with context and trace name

## <a name="NewTripper">func</a> [NewTripper](./httptripper.go#L122)
``` go
func NewTripper() http.RoundTripper
```
NewTripper returns a default tripper wrapped around http.DefaultTransport

## <a name="SetRequestTraceName">func</a> [SetRequestTraceName](./httptripper.go#L152)
``` go
func SetRequestTraceName(req *http.Request, traceName string) *http.Request
```
SetRequestTraceName stores a trace name in a HTTP request

## <a name="WrapTripper">func</a> [WrapTripper](./httptripper.go#L113)
``` go
func WrapTripper(base http.RoundTripper) http.RoundTripper
```
WrapTripper wraps the base tripper with zipkin info

- - -
Generated by [godoc2ghmd](https://github.com/GandalfUK/godoc2ghmd)